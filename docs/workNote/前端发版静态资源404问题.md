# å‰ç«¯å‘ç‰ˆé™æ€èµ„æº404é—®é¢˜

## èƒŒæ™¯

> ä¸€ä¸ªä½¿ç”¨ Vue å¼€å‘çš„å•é¡µé¢åº”ç”¨ï¼Œåœ¨ä¸€æ¬¡æµ‹è¯•åœ¨ä½¿ç”¨ä¸­ï¼Œå‘ç°ä½¿ç”¨ç€ä½¿ç”¨ç€ï¼Œçªç„¶é¡µé¢ç‚¹å‡»æ— æ•ˆæœï¼ˆä½¿ç”¨ä¸­å‰ç«¯è¿›è¡Œè¿‡ä¸€æ¬¡å‘ç‰ˆï¼‰ï¼Œæµ‹è¯•æ‰“å¼€æ§åˆ¶å°ï¼Œå‘ç°æ§åˆ¶å°ä¸€å † js æ–‡ä»¶çš„ 404 æŠ¥é”™ï¼š
>
> ![image-20240118155034294](../images/å‰ç«¯å‘ç‰ˆé™æ€èµ„æºæ‰¾ä¸åˆ°é—®é¢˜.png)



## ç°è±¡æè¿°

æ ¹æ®æµ‹è¯•åé¦ˆç°è±¡å¦‚ä¸‹ï¼š

1. ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¹‹å‰ç‚¹å‡»æŸä¸ªé¡µé¢æ˜¯æ­£å¸¸ï¼Œ(å½“å‰å‘ç‰ˆä¹‹å)ï¼Œç‚¹å‡»å…¶ä»–é¡µé¢æ— ä»»ä½•ååº”;
2. æ‰“å¼€æ§åˆ¶å°ï¼Œç‚¹å‡»ä»»ä½•ä¸€ä¸ªé¡µé¢æ—¶å€™ï¼Œä¼šåŠ¨æ€åŠ è½½çš„ä¸€ä¸ª JS æ–‡ä»¶ï¼Œç„¶å JS æ–‡ä»¶åŠ è½½æ˜¾ç¤º 404 æŠ¥é”™ï¼›
3. æµ‹è¯•å‘˜æµè§ˆå™¨ -> å¼€å‘è€…å·¥å…· -> æ§åˆ¶å° -> ç½‘ç»œ -> åœç”¨ç¼“å­˜ ï¼Œ åœç”¨ç¼“å­˜ é€‰é¡¹æœªå‹¾é€‰ã€‚
4. å½“æµ‹è¯•å‘˜åˆ·æ–°é¡µé¢åï¼Œåˆèƒ½é‡æ–°æ­£å¸¸åŠ è½½é™æ€èµ„æºã€‚



## **é—®é¢˜å¤ç°**

1. æ‰“å¼€æµè§ˆå™¨ -> å¼€å‘è€…å·¥å…· -> æ§åˆ¶å° -> ç½‘ç»œ -> åœç”¨ç¼“å­˜ ï¼Œ åœç”¨ç¼“å­˜ é€‰é¡¹æœªå‹¾é€‰ï¼›
2. æ‰“å¼€é¡¹ç›®ï¼Œè¿›å…¥æ¨¡å— Aï¼Œé¡µé¢åœç•™åœ¨æ¨¡å— A ä¸åŠ¨ï¼›
3. å‰ç«¯æ‰“åŒ…èµ„æºå¹¶å‘å¸ƒç‰ˆæœ¬ï¼›
4. å›åˆ°é¡¹ç›®ï¼Œç‚¹å‡»æ¨¡å— B é¡µé¢ï¼›
5. æŸ¥çœ‹æµè§ˆå™¨ -> å¼€å‘è€…å·¥å…· -> æ§åˆ¶å° -> ç½‘ç»œï¼Œå‘ç° B æ¨¡å—é™æ€èµ„æº JS æ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤º  404 çŠ¶æ€ï¼›
6. æµè§ˆå™¨åˆ·æ–°é¡µé¢åï¼Œæ¨¡å— B é™æ€èµ„æºåŠ è½½æˆåŠŸï¼Œä½†æ˜¯æ­¤æ—¶æ¨¡å— B çš„é™æ€èµ„æº JS æ–‡ä»¶åç§°å‘ç”Ÿäº†å˜åŒ–ï¼›
7. å¯¹æ¯”æœ¬åœ°æ„å»ºåçš„é™æ€èµ„æºæ–‡ä»¶ï¼Œå‘ç°å¯ä»¥æ‰¾åˆ° B æ¨¡å—çš„ JS èµ„æºæ–‡ä»¶ï¼Œè¯æ˜åˆ·æ–°åé‡æ–°è·å–äº†æ›´æ–°å‘ç‰ˆåçš„ JS èµ„æºæ–‡ä»¶ï¼›



## åŸå› åˆ†æ

>  é€šè¿‡åˆ†æç°è±¡å‘ç°ï¼Œå®é™…æ˜¯å‰ç«¯æ›´æ–°å·²ä¸Šçº¿çš„é¡¹ç›®ï¼Œç”¨æˆ·çš„æµè§ˆå™¨æ˜¾ç¤ºçš„å´æ˜¯æ—§ç‰ˆçš„é¡µé¢ï¼ˆæµè§ˆå™¨ç¼“å­˜ï¼‰ï¼Œæ²¡æœ‰åŠæ—¶è·å–åˆ°æ›´æ–°çš„èµ„æºï¼Œæµè§ˆå™¨è¯·æ±‚æ—§ç‰ˆæœ¬èµ„æºï¼Œä½†æ˜¯æ—§ç‰ˆæœ¬èµ„æºå·²ç»è¢«æ–°ç‰ˆæœ¬èµ„æºè¦†ç›–ï¼Œå·²ç»ä¸å­˜åœ¨ï¼Œæ‰€ä»¥äº§ç”Ÿ 404 æŠ¥é”™ï¼›
>
> æ­¤æ—¶ï¼Œå¦‚æœç”¨æˆ·åˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼Œå°±å¾—åˆ°æ›´æ–°åçš„èµ„æº

åœ¨åˆ†æäº§ç”Ÿæµè§ˆå™¨ç¼“å­˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆéœ€è¦äº†è§£ï¼Œåœ¨æˆ‘ä»¬å•é¡µé¢åº”ç”¨ä¸­ï¼Œé™æ€èµ„æºæ˜¯å¦‚ä½•è¢«åˆ†å‰²å’Œç¼“å­˜çš„ï¼›

åœ¨æˆ‘ä»¬ä»¬å¼€å‘æ—¶å€™ï¼Œç»å¸¸ä¼šåœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ¨¡å—æŒ‰éœ€åŠ è½½ï¼š

### **æ¨¡å—æŒ‰éœ€åŠ è½½é—®é¢˜**

* åœ¨ä½¿ç”¨ Vue/React æ„å»ºçš„å•é¡µé¢åº”ç”¨ä¸­ï¼Œå› ä¸ºè®¸å¤šåŠŸèƒ½éƒ½é›†ä¸­çš„åšåˆ°äº†ä¸€ä¸ª HTMLä¸­ï¼Œ ä¸ºäº†é¿å…ä¸€æ¬¡æ€§çš„åŠ è½½æ‰€æœ‰åŠŸèƒ½å¯¹åº”çš„ä»£ç ï¼Œè§£å†³åŠ è½½ç¼“æ…¢ã€äº¤äº’å¡é¡¿é—®é¢˜ï¼›æˆ‘ä»¬é€šå¸¸ä¼šåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ åŠ¨æ€åŠ è½½æ¨¡å—æœºåˆ¶ ï¼Œé€šè¿‡ä½¿ç”¨ webpack  æŒ‰éœ€åŠ è½½æœºåˆ¶ï¼ŒæŠŠæ¯ä¸€ç±»åˆå¹¶ä¸ºä¸€ä¸ª Chunkï¼ŒæŒ‰éœ€åŠ è½½å¯¹åº”çš„ Chunkï¼Œ**ä¸åŒæ¨¡å—çš„åŒç±»é™æ€èµ„æºé€šè¿‡åœ¨æ–‡ä»¶åç§°åæ·»åŠ hashåŒºåˆ†**ï¼›ï¼ˆå‚è€ƒèµ„æ–™ï¼š[ã€Šæ·±å…¥æµ…å‡ºwebpack-åˆ†å‰²ä»£ç æŒ‰éœ€åŠ è½½ã€‹](https://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-12%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD.html)ï¼‰

* åœ¨ä½¿ç”¨ Vue/React æ„å»ºçš„å•é¡µé¢åº”ç”¨ä¸­ï¼Œé€šè¿‡ä½¿ç”¨è·¯ç”±çš„æŒ‰éœ€åŠ è½½ï¼Œå®ç°æ ¹æ®è·¯ç”±åŠ¨æ€åŠ è½½è·¯ç”±æ¨¡å—ï¼š

  * Vue é¡¹ç›®è·¯ç”±é…ç½®ä¸­é€šè¿‡åŠ¨æ€å¼•å…¥ç»„ä»¶å®ç°è·¯ç”±æ¨¡å—æŒ‰éœ€åŠ è½½ï¼š![image-20240118165028880](../images/vueæŒ‰éœ€åŠ è½½.png)

  * äº§ç”Ÿç°è±¡ï¼š

    * ç‚¹å‡»æ¨¡å— A æ—¶ï¼Œç½‘ç»œè¯·æ±‚åŠ è½½ä»¥ä¸‹é™æ€èµ„æºæ–‡ä»¶ï¼š

      ![image-20240118165447549](../images/åŠ¨æ€åŠ è½½æ¨¡å—.png)

    * ç‚¹å‡»æ¨¡å— B æ—¶ï¼ŒåŠ è½½æ¨¡å— B çš„é™æ€èµ„æºæ–‡ä»¶ï¼š ![image-20240118165802979](../images/åŠ¨æ€åŠ è½½æ¨¡å—2.png)

ä»ä¸Šå›¾åˆ†æå¯çœ‹å‡ºï¼Œé€šè¿‡ åŠ¨æ€å¼•å…¥ç»„ä»¶å®ç°è·¯ç”±æ¨¡å—æŒ‰éœ€åŠ è½½ï¼Œwebpack åœ¨æ„å»ºæ—¶å€™ä¼šå°†ä¸åŒè·¯ç”±ç»„ä»¶æ‰“åŒ…æˆä¸åŒçš„ä»£ç  chunkï¼Œé€šè¿‡æ–‡ä»¶åç§°+hash çš„æ–¹å¼åŒºåˆ†ç›¸åŒç±»å‹çš„ä¸åŒæ–‡ä»¶ã€‚

### **æµè§ˆå™¨ç¼“å­˜é—®é¢˜**

> æµè§ˆå™¨ç¼“å­˜æ˜¯å‰ç«¯ä¼˜åŒ–çš„ä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œç¼“å­˜å¯ä»¥å¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼š
>
> 1. å‡å°‘å†—ä½™çš„æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœå¸¦å®½ï¼›
> 2. å‡è½»æœåŠ¡å™¨çš„è¯·æ±‚è´Ÿæ‹…ï¼Œæœ‰ç¼“å­˜å°±å¯ä»¥å°‘å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸€äº›è®¿é—®é‡å¤§çš„ç½‘ç«™è¿™ç‚¹è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼›
> 3. èµ„æºä»ç¼“å­˜ä¸­è¯»å–ï¼Œæ— éœ€å‘æœåŠ¡å™¨å‘é€è¯·æ±‚å†ç­‰å¾…è¿”å›ï¼ŒåŠ å¿«äº†å®¢æˆ·ç«¯çš„è®¿é—®é€Ÿåº¦ã€‚
>
> ä½†æ˜¯ç¼“å­˜åŒæ ·ç»™å‰ç«¯å¸¦æ¥äº†ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼š**å‰ç«¯å‘ç‰ˆé™æ€èµ„æº404é—®é¢˜**
>
> * å¦‚æœå‰ç«¯é‡æ–°æ„å»ºèµ„æºå‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯ç”¨æˆ·è®¿é—®æ—¶æµè§ˆå™¨è¯»å–çš„æ˜¯ç¼“å­˜èµ„æºï¼Œé‚£ä¹ˆç”¨æˆ·å°±è·å–ä¸åˆ°æœ€æ–°çš„é¡µé¢ï¼Œå½±å“ç”¨æˆ·ä½¿ç”¨ã€‚ 
>
> æµè§ˆå™¨ç¼“å­˜ä¸»è¦æŒ‡httpç¼“å­˜ï¼Œå…¶æœºåˆ¶æ˜¯æ ¹æ®httpæŠ¥æ–‡çš„ç¼“å­˜æ ‡è¯†è¿›è¡Œç›¸åº”æ“ä½œã€‚

#### **æµè§ˆå™¨ç¼“å­˜ä»‹ç»**

æµè§ˆå™¨ç¼“å­˜ä½ç½®æœ‰ï¼š

- **Service Worker**ï¼šè¿è¡Œåœ¨æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹çº¿ç¨‹ï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±æ§åˆ¶ç¼“å­˜å“ªäº›æ–‡ä»¶ã€å¦‚ä½•åŒ¹é…ç¼“å­˜ã€å¦‚ä½•è¯»å–ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜æ˜¯æŒç»­æ€§çš„ï¼›
- **Memory Cache**ï¼š å†…å­˜ä¸­çš„ç¼“å­˜ï¼›ç¼“å­˜æŒç»­æ€§å¾ˆçŸ­ï¼Œä¼šéšç€è¿›ç¨‹çš„é‡Šæ”¾è€Œé‡Šæ”¾ã€‚**ä¸€æ—¦æˆ‘ä»¬å…³é—­ Tab é¡µé¢ï¼Œå†…å­˜ä¸­çš„ç¼“å­˜ä¹Ÿå°±è¢«é‡Šæ”¾äº†**ã€‚
- **Disk Cache**ï¼šå­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ç¼“å­˜ï¼›æ ¹æ® HTTP Herder ä¸­çš„å­—æ®µåˆ¤æ–­å“ªäº›èµ„æºéœ€è¦ç¼“å­˜ï¼Œå“ªäº›èµ„æºå¯ä»¥ä¸è¯·æ±‚ç›´æ¥ä½¿ç”¨ï¼Œå“ªäº›èµ„æºå·²ç»è¿‡æœŸéœ€è¦é‡æ–°è¯·æ±‚ã€‚
- **Push Cache**ï¼šHTTP/2 ä¸­çš„å†…å®¹ï¼Œ**åªåœ¨ä¼šè¯ï¼ˆSessionï¼‰ä¸­å­˜åœ¨ï¼Œä¸€æ—¦ä¼šè¯ç»“æŸå°±è¢«é‡Šæ”¾ï¼Œå¹¶ä¸”ç¼“å­˜æ—¶é—´ä¹Ÿå¾ˆçŸ­æš‚**ï¼Œåœ¨Chromeæµè§ˆå™¨ä¸­åªæœ‰5åˆ†é’Ÿå·¦å³ï¼ŒåŒæ—¶å®ƒä¹Ÿå¹¶éä¸¥æ ¼æ‰§è¡ŒHTTPå¤´ä¸­çš„ç¼“å­˜æŒ‡ä»¤ã€‚

>  *è¯¦ç»†çš„æµè§ˆå™¨ç¼“å­˜çŸ¥è¯†å‚è€ƒæˆ‘çš„åšå®¢ï¼š[å‰ç«¯å­˜å‚¨ | Sewen åšå®¢ (sewar-x.github.io)](https://sewar-x.github.io/browser/å‰ç«¯å­˜å‚¨/#æµè§ˆå™¨ç¼“å­˜æœºåˆ¶)*



#### **æµè§ˆå™¨ç¼“å­˜æ£€æŸ¥**

é€šè¿‡ä»¥ä¸‹æ“ä½œï¼Œå¯ä»¥æŸ¥çœ‹æµè§ˆå™¨æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜ï¼š

**ç¬¬ä¸€æ­¥ï¼š**

ç¦æ­¢å‹¾é€‰æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­ â€œç¦ç”¨ç¼“å­˜é€‰é¡¹â€ï¼šæ‰“å¼€æµè§ˆå™¨  -> å¼€å‘è€…å·¥å…· -> æ§åˆ¶å° -> ç½‘ç»œ

![image-20240119101631923](../images/æµè§ˆå™¨ç¼“å­˜æ“ä½œ3.png)



**ç¬¬äºŒæ­¥ï¼š**

æ‰“å¼€æµè§ˆå™¨  -> å¼€å‘è€…å·¥å…· -> æ§åˆ¶å° -> ç½‘ç»œ -> æŸ¥çœ‹å…¨éƒ¨èµ„æº-> ç‚¹å‡»æ¨¡å—èµ„æº ->  æ£€æŸ¥ http çŠ¶æ€ç ï¼š

**é¦–æ¬¡ç‚¹å‡»åŠ è½½æ¨¡å—**ï¼ŒæŸ¥çœ‹èµ„æºè¯·æ±‚çŠ¶æ€ï¼š

![image-20240119102723498](../images/æµè§ˆå™¨ç¼“å­˜4.png)

> ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œé¦–æ¬¡è¯·æ±‚æ—¶å€™ï¼š
>
> 1. æµè§ˆå™¨ä¼šç›´æ¥è¯·æ±‚æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨è·å–å½“å‰JSèµ„æº
>
> 2. ç„¶åæµè§ˆå™¨ä¼šè¿”å›å½“å‰èµ„æºçš„ç¼“å­˜æ ‡è¯†ï¼Œå‘Šè¯‰æµè§ˆå™¨éœ€è¦ç¼“å­˜å½“å‰JSèµ„æºï¼Œæµè§ˆå™¨ä¼šå°†æ­¤èµ„æºç¼“å­˜åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼›
>
> <img src="../images/æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚ç¼“å­˜.png" alt="image-20240119104745465" style="zoom: 80%;" />



**ç¬¬ä¸‰æ­¥ï¼š**

åˆ·æ–°å½“å‰é¡µé¢ï¼ŒæŸ¥çœ‹èµ„æºè¯·æ±‚çŠ¶æ€ï¼š

![image-20240119103607703](../images/æµè§ˆå™¨ç¼“å­˜5.png)

> ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå½“åˆ·æ–°é¡µé¢æ—¶å€™ï¼š
>
> 1. æµè§ˆå™¨åˆ¤æ–­å½“å‰èµ„æºç¼“å­˜æ ‡è¯†ï¼Œå‘ç°ç¼“å­˜å°šæœªå¤±æ•ˆï¼Œå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆï¼›
> 2. æµè§ˆå™¨ç›´æ¥é€šè¿‡æµè§ˆå™¨å†…å­˜ç¼“å­˜ä¸­è·å–è¯¥èµ„æºï¼Œå¹¶è¿”å›ï¼›
>    <img src="../images/å¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆ.png" alt="image-20240119104925927" style="zoom: 80%;" />



**ç¬¬å››æ­¥**

1. å…³é—­å½“å‰é¡µé¢ï¼Œé‡æ–°æ‰“å¼€æµè§ˆå™¨tabå¹¶æ‰“å¼€é¡µé¢ï¼›
2. åˆ·æ–°å½“å‰é¡µé¢ï¼ŒæŸ¥çœ‹èµ„æºè¯·æ±‚çŠ¶æ€ï¼š

![image-20240119105508718](../images/åå•†ç¼“å­˜ç¤ºä¾‹.png)

> ä» ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œåˆ·æ–°é¡µé¢åï¼Œå†æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼Œè¿›è¡Œ**åå•†ç¼“å­˜**ï¼š
>
> 1. æµè§ˆå™¨å‘ç°èµ„æºç¼“å­˜çš„å†…å­˜ç¼“å­˜å·²ç»å¤±æ•ˆï¼›
> 2. æµè§ˆå™¨æºå¸¦ç¼“å­˜æ ‡è¯†è¯·æ±‚æœåŠ¡å™¨èµ„æºï¼›
> 3. æœåŠ¡å™¨è¿”å› 304 è¡¨ç¤ºè¯¥é™æ€èµ„æºæ— æ›´æ–°ï¼›
> 4. æµè§ˆå™¨å‘ç° 304 èµ„æºæ— æ›´æ–°ï¼Œåˆ™ä»æœ¬åœ°ç£ç›˜ç¼“å­˜ä¸­æŸ¥æ‰¾è¯¥èµ„æºï¼›
>
> <img src="../images/åå•†ç¼“å­˜.png" alt="image-20240119105104986" style="zoom:80%;" />



**ç¬¬äº”æ­¥**

1. å‰ç«¯é‡æ–°æ„å»ºé¡¹ç›®ï¼Œé‡æ–°å‘å¸ƒç‰ˆæœ¬ï¼›
2. æ‰“å¼€æ¨¡å—é¡µé¢ï¼Œåˆ·æ–°ï¼ŒæŸ¥çœ‹èµ„æºè¯·æ±‚çŠ¶æ€ï¼š

![image-20240118174302178](../images/æµè§ˆå™¨ç¼“å­˜3.png)

> ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬é‡æ–°æ„å»ºå‰ç«¯é¡¹ç›®ï¼Œé‡æ–°å‘å¸ƒç‰ˆæœ¬ä¹‹åï¼Œå†æ¬¡æ‰“å¼€åŸæ¥é¡¹ç›®ï¼Œåˆ·æ–°é¡µé¢åï¼š
>
> 1. æµè§ˆå™¨æ ¹æ®ç¼“å­˜æ ‡è¯†ï¼Œå‘æµè§ˆå™¨ç¼“å­˜ä¸­è·å–JSèµ„æºï¼›
> 2. æµè§ˆå™¨ç¼“å­˜å‘ç°JSç¼“å­˜å¤±æ•ˆï¼Œåˆ™è¿”å›å‘Šè¯‰æµè§ˆå™¨ï¼Œèµ„æºç¼“å­˜å¤±æ•ˆï¼›
> 3. æµè§ˆå™¨ä¼šæ‹¿åˆ°ç¼“å­˜æ ‡è¯†ï¼Œå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼›
> 4. æœåŠ¡å™¨è¿”å› 200 çŠ¶æ€å’Œæœ€æ–°çš„ JS èµ„æºï¼›
> 5. æµè§ˆå™¨æ ¹æ®ç¼“å­˜æ ‡è¯†ï¼Œå°†èµ„æºå­˜å…¥æœ¬åœ°ç¼“å­˜ï¼›
> 6. å½“ç”¨æˆ·å†æ¬¡åˆ·æ–°é¡µé¢æ—¶å€™ï¼Œæµè§ˆå™¨ç¼“å­˜æ ‡è¯†ï¼Œä»æœ¬åœ°è·å–èµ„æºï¼›
>
> <img src="../images/åå•†ç¼“å­˜å¤±æ•ˆ.png" alt="image-20240119110211453" style="zoom:80%;" />



### **èµ„æº404åŸå› åˆ†æ**

é€šè¿‡ä»¥ä¸ŠæŒ‰éœ€åŠ è½½å’Œæµè§ˆå™¨ç¼“å­˜è¿‡ç¨‹åˆ†æå¯çŸ¥ï¼š

1. é¡¹ç›®ä¸­é€šè¿‡æ¨¡å—æŒ‰éœ€åŠ è½½å°†é¡¹ç›®é™æ€èµ„æºè¿›è¡Œåˆ†å‰²ï¼Œå› æ­¤ä¸åŒé¡µé¢æ¨¡å—çš„ JS èµ„æºä¸åŒï¼Œåœ¨ç‚¹å‡»é¡¹ç›®ä¸åŒæ¨¡å—æ—¶å€™ï¼Œä¸ºäº†å‡å°‘é¡¹ç›®ä½“ç§¯ï¼Œä¼šè¿›è¡ŒæŒ‰éœ€åŠ è½½èµ„æºï¼ŒåŠ¨æ€è¯·æ±‚å½“å‰æ¨¡å—èµ„æºï¼›

2. é¦–æ¬¡è¯·æ±‚æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚æ¨¡å—å¯¹åº”èµ„æºï¼›

3. æµè§ˆå™¨åœ¨é¦–æ¬¡åŠ è½½æ¨¡å—æ—¶å¯èƒ½ä¼šå¯¹é™æ€èµ„æºæ–‡ä»¶è¿›è¡Œç¼“å­˜ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚å½“é‡æ–°å‘å¸ƒé™æ€èµ„æºåï¼Œæ–°çš„æ¨¡å—çš„é™æ€èµ„æºæ–‡ä»¶çš„URLä¸æ—§çš„æ¨¡å—çš„é™æ€èµ„æºæ–‡ä»¶çš„URLä¸åŒï¼Œæµè§ˆå™¨å¯èƒ½ä»ç„¶ä½¿ç”¨äº†æ—§çš„ç¼“å­˜æ–‡ä»¶ï¼Œå¯¼è‡´åŠ è½½å¤±è´¥ï¼›

4. ç”±äºæµè§ˆå™¨çš„ç¼“å­˜ç­–ç•¥å¯¼è‡´æ€èµ„æºHTMLæ–‡ä»¶è¢«ç¼“å­˜ï¼Œæµè§ˆå™¨è·å–çš„æ˜¯æ—§ç‰ˆæœ¬çš„ HTML èµ„æºï¼Œè€Œå…¶ä»–é™æ€èµ„æºé€šè¿‡ HTML æ–‡ä»¶ä¸­å®šä¹‰çš„åç§°è·å–ï¼Œå› æ­¤å½“å‘å¸ƒæ–°çš„ç‰ˆæœ¬æ—¶ï¼Œæµè§ˆå™¨ä¾æ—§é€šè¿‡æ—§ç‰ˆæœ¬HTMLæ–‡ä»¶ä¸­å®šä¹‰çš„å…¶ä»–èµ„æºæ—§åç§°è·å–èµ„æºï¼Œå¯¼è‡´åŠ è½½ 404 é”™è¯¯ã€‚

   ![image-20240131094237119](../images/é™æ€èµ„æº404æŠ¥é”™é—®é¢˜.png)

> å¯èƒ½å¯¼è‡´é™æ€èµ„æºåŠ è½½å¤±è´¥çš„åŸå› ï¼š
>
> 1. **é¡µé¢ç¼“å­˜**ï¼š
>    * è™½ç„¶é™æ€èµ„æºæ–‡ä»¶åç§°æ¯æ¬¡å‘ç‰ˆåéƒ½ä¼šå‘ç”Ÿå˜åŒ– (hashå€¼å‘ç”Ÿå˜åŒ–)ï¼Œä½†æµè§ˆå™¨å¯èƒ½ä»ç„¶ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„HTMLæ–‡ä»¶ã€‚
>    * å½“é‡æ–°å‘å¸ƒé™æ€èµ„æºåï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚æ–°çš„é™æ€èµ„æºæ–‡ä»¶ï¼Œä½†ä»ç„¶ä½¿ç”¨ç¼“å­˜çš„æ—§ç‰ˆæœ¬HTMLæ–‡ä»¶ä¸­å¼•ç”¨çš„é™æ€èµ„æºæ–‡ä»¶åç§°ï¼Œå¯¼è‡´åŠ è½½å¤±è´¥ã€‚
>    * è§£å†³æ–¹æ¡ˆæ˜¯åœ¨HTMLæ–‡ä»¶çš„`<link>`æˆ–`<script>`æ ‡ç­¾ä¸­ï¼Œæ·»åŠ ç‰ˆæœ¬å·æˆ–å“ˆå¸Œå€¼æ¥ç¡®ä¿å¼•ç”¨çš„é™æ€èµ„æºæ–‡ä»¶åç§°ä¸å®é™…å‘å¸ƒçš„æ–‡ä»¶åç§°ä¿æŒä¸€è‡´ã€‚
> 2. **å¼•ç”¨è·¯å¾„é—®é¢˜**ï¼š
>    * åœ¨æ›´æ–°é¡¹ç›®ç‰ˆæœ¬åï¼Œé™¤äº†é™æ€èµ„æºæ–‡ä»¶åç§°å‘ç”Ÿå˜åŒ–å¤–ï¼Œè¿˜éœ€è¦ç¡®ä¿HTMLæ–‡ä»¶ä¸­å¼•ç”¨çš„é™æ€èµ„æºæ–‡ä»¶çš„è·¯å¾„æ­£ç¡®ã€‚
>    * å¦‚æœè·¯å¾„ä¸æ­£ç¡®ï¼Œæµè§ˆå™¨æ— æ³•æ‰¾åˆ°å¯¹åº”çš„é™æ€èµ„æºæ–‡ä»¶ï¼Œå¯¼è‡´åŠ è½½å¤±è´¥ã€‚
>    * å› æ­¤éœ€è¦ç¡®ä¿HTMLæ–‡ä»¶ä¸­å¼•ç”¨çš„é™æ€èµ„æºæ–‡ä»¶çš„è·¯å¾„ä¸å®é™…å‘å¸ƒçš„è·¯å¾„ä¸€è‡´ã€‚
> 3. **æœåŠ¡å™¨é…ç½®**ï¼š
>    * åœ¨é™æ€èµ„æºæœåŠ¡å™¨ä¸Šï¼Œå¯èƒ½å­˜åœ¨é…ç½®é—®é¢˜ï¼Œå¯¼è‡´æ— æ³•æ­£ç¡®è®¿é—®æ–°ç‰ˆæœ¬çš„é™æ€èµ„æºæ–‡ä»¶ã€‚
>    * ç¡®ä¿é™æ€èµ„æºæœåŠ¡å™¨é…ç½®æ­£ç¡®ï¼Œå¹¶èƒ½å¤Ÿæ­£ç¡®åœ°æä¾›æ–°ç‰ˆæœ¬çš„é™æ€èµ„æºæ–‡ä»¶ã€‚
>
> æ€»ç»“èµ·æ¥ï¼Œé™æ€èµ„æºåŠ è½½å¤±è´¥çš„åŸå› å¯èƒ½åŒ…æ‹¬ï¼š æµè§ˆå™¨ç¼“å­˜æ—§ç‰ˆæœ¬HTMLæ–‡ä»¶ã€å¼•ç”¨è·¯å¾„ä¸æ­£ç¡®ä»¥åŠæœåŠ¡å™¨é…ç½®é—®é¢˜ã€‚
>
> å¯ä»¥å°è¯•æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€æ£€æŸ¥HTMLæ–‡ä»¶ä¸­çš„é™æ€èµ„æºå¼•ç”¨è·¯å¾„ï¼Œä»¥åŠç¡®ä¿é™æ€èµ„æºæœåŠ¡å™¨èƒ½å¤Ÿæ­£ç¡®æä¾›æ–°ç‰ˆæœ¬çš„é™æ€èµ„æºæ–‡ä»¶ï¼Œä»¥è§£å†³é™æ€èµ„æºåŠ è½½å¤±è´¥çš„é—®é¢˜ã€‚



## è§£å†³æ–¹æ¡ˆ

### **nginxåå‘ä»£ç†**

> ä»¥ Vue ä¸ºä¾‹ï¼ŒVue åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œ`css` å’Œ `js` åå­—éƒ½åŠ äº†å“ˆå¸Œå€¼ï¼Œæ‰€ä»¥æ”¹åŠ¨åæ‰“åŒ…ç”Ÿæˆçš„jså’Œcssæ˜¯å”¯ä¸€çš„ï¼Œé¡µé¢è¯·æ±‚çš„æ˜¯æ–°èµ„æºï¼Œä¸ä¼šæœ‰ç¼“å­˜é—®é¢˜ã€‚
>
> ä½†æ˜¯å…¥å£æ–‡ä»¶ `index.html` ä¼šå› ä¸ºç¼“å­˜é€ æˆæ›´æ–°é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬æ›´æ–°äº†ï¼Œä½†æ˜¯æµè§ˆå™¨ä½¿ç”¨çš„æ˜¯ç¼“å­˜ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚
>
> æ‰€ä»¥éœ€è¦å¯¹å…¥å£æ–‡ä»¶è®¾ç½®ä¸ä½¿ç”¨å¼ºåˆ¶ç¼“å­˜ï¼Œéœ€è¦æ¯æ¬¡å»æœåŠ¡å™¨éªŒè¯æ–‡ä»¶æ˜¯å¦ä¿®æ”¹ï¼Œå³ä½¿ç”¨åå•†ç¼“å­˜ã€‚
>
> ä½¿ç”¨ `nginx` åå‘ä»£ç†ï¼Œåœ¨ `nginx.conf `æ–‡ä»¶çš„å¯¹åº” `server `ä¸­è®¾ç½® ` Cache-Control no-store`

`nginx` åå‘ä»£ç†é…ç½®ç¤ºä¾‹ï¼š

```nginx
server {
    listen  ç›‘å¬ç«¯å£å·;
    server_name  åŸŸå;
    root   æ–‡ä»¶ç›®å½•;
    index  index.html;

    location / {  // ä¸åŠ è¿™ä¸€å¥ï¼Œä¼šå‡ºç°nginxæ¬¢è¿é¡µé¢ï¼Œæ— æ³•æ­£ç¡®åŠ è½½èµ„æº
      try_files $uri /index.html;
    }

    location ~ .*\.(html)$ {  // å¯¹htmlæ–‡ä»¶é™åˆ¶ç¼“å­˜
      add_header Cache-Control no-store;  // åœ¨æ­¤æ—¶æ·»åŠ ï¼Œå¯¹ html é¡µé¢ä¸ç¼“å­˜
     // æˆ–è€…ç”¨add_header Cache-Control no-cache;æ›¿ä»£ä¸Šé¢é‚£ä¸€å¥ï¼Œåå•†ç¼“å­˜
      add_header Pragma no-cache;
    }

```



æ³¨æ„ï¼š

`Cache-Control: no-cache` å’Œ `Cache-Control: no-store `åŒºåˆ« :

> å®ƒä»¬éƒ½æ˜¯HTTPå“åº”å¤´ä¸­æ§åˆ¶ç¼“å­˜è¡Œä¸ºçš„æŒ‡ä»¤ã€‚ä½†å­˜åœ¨ä¸€äº›åŒºåˆ«ï¼š
>
> * `Cache-Control: no-cache`ï¼šè¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰æµè§ˆå™¨åœ¨ä½¿ç”¨ç¼“å­˜å‰éœ€è¦å…ˆè¿›è¡ŒéªŒè¯ã€‚
>   * å½“æµè§ˆå™¨æ¥æ”¶åˆ°å¸¦æœ‰æ­¤æŒ‡ä»¤çš„å“åº”æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªæ¡ä»¶è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œä»¥ç¡®å®šç¼“å­˜çš„å‰¯æœ¬æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚
>   * æœåŠ¡å™¨å¯ä»¥é€šè¿‡æ£€æŸ¥å“åº”çš„æ¡ä»¶å¤´ï¼ˆå¦‚ `ETag` æˆ– `Last-Modified `ï¼‰æ¥åˆ¤æ–­æ˜¯å¦è¿”å›æ–°çš„å†…å®¹ã€‚
>   * å¦‚æœæœåŠ¡å™¨è¿”å›äº†çŠ¶æ€ç  304ï¼ˆNot Modifiedï¼‰ï¼Œåˆ™è¡¨ç¤ºç¼“å­˜çš„å‰¯æœ¬ä»ç„¶æœ‰æ•ˆï¼Œæµè§ˆå™¨å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚
>   * å¦‚æœæœåŠ¡å™¨è¿”å›äº†æ–°çš„å†…å®¹ï¼Œæµè§ˆå™¨å°†ä½¿ç”¨æ–°çš„å†…å®¹å¹¶æ›´æ–°ç¼“å­˜ã€‚
>
> * `Cache-Control: no-store` ï¼šè¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰æµè§ˆå™¨ä¸è¦ç¼“å­˜ä»»ä½•å“åº”å†…å®¹ï¼Œå³ä½¿æ˜¯ä¸´æ—¶çš„æˆ–ç§æœ‰çš„æ•°æ®ã€‚
>   * æ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»ä»æœåŠ¡å™¨è·å–å®Œæ•´çš„å“åº”ã€‚
>   * è¿™æ„å‘³ç€å“åº”çš„å†…å®¹ä¸ä¼šè¢«ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸ä¼šè¢«å†™å…¥ç£ç›˜æˆ–å…¶ä»–æŒä¹…å­˜å‚¨ã€‚
>   * è¿™å¯ä»¥ç”¨äºç¡®ä¿æ•æ„Ÿæ•°æ®ä¸ä¼šè¢«ç¼“å­˜ï¼Œä»¥å¢åŠ å®‰å…¨æ€§ã€‚
>
> æ€»ç»“èµ·æ¥ï¼ŒåŒºåˆ«åœ¨äºï¼š
>
> * `no-cache` æŒ‡ä»¤è¦æ±‚æµè§ˆå™¨åœ¨ä½¿ç”¨ç¼“å­˜å‰è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿ç¼“å­˜çš„å‰¯æœ¬ä»ç„¶æœ‰æ•ˆï¼Œå¦‚æœæ— æ•ˆåˆ™è·å–æ–°çš„å†…å®¹æ›´æ–°ç¼“å­˜ã€‚
> * `no-store` æŒ‡ä»¤åˆ™è¦æ±‚æµè§ˆå™¨ä¸è¦ç¼“å­˜ä»»ä½•å“åº”å†…å®¹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»ä»æœåŠ¡å™¨è·å–å®Œæ•´çš„å“åº”ï¼Œä¸”ä¸ä¼šå°†å“åº”å†…å®¹ä¿å­˜åœ¨



`Pragma: no-cache` å’Œ `Cache-Control: no-cache` åŒºåˆ«

> éƒ½æ˜¯ç”¨äºæ§åˆ¶ç¼“å­˜è¡Œä¸ºçš„HTTPå¤´å­—æ®µï¼Œä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€äº›åŒºåˆ«ï¼š
>
> 1. `Pragma: no-cache`ï¼šè¿™ä¸ªå¤´å­—æ®µæ˜¯ `HTTP/1.0` æ—¶ä»£çš„é—ç•™å­—æ®µï¼Œç”¨äºå‘æ—§ç‰ˆçš„HTTPå®¢æˆ·ç«¯å’Œç¼“å­˜ä»£ç†æœåŠ¡å™¨ä¼ è¾¾ä¸ç¼“å­˜å“åº”çš„æŒ‡ä»¤ã€‚åœ¨ç°ä»£çš„ `HTTP/1.1` ä¸­ï¼Œæ¨èä½¿ç”¨`Cache-Control`å¤´å­—æ®µæ¥æ§åˆ¶ç¼“å­˜è¡Œä¸ºã€‚å°½ç®¡ `Pragma: no-cache` åœ¨ä¸€äº›æƒ…å†µä¸‹ä»ç„¶è¢«ä½¿ç”¨ï¼Œä½†å®ƒä¸æ˜¯HTTP/1.1è§„èŒƒä¸­å®šä¹‰çš„é¦–é€‰æ–¹å¼ã€‚
>
> 2. `Cache-Control: no-cache`ï¼šè¿™ä¸ªå¤´å­—æ®µæ˜¯HTTP/1.1å¼•å…¥çš„ï¼Œå¹¶æˆä¸ºæ§åˆ¶ç¼“å­˜è¡Œä¸ºçš„ä¸»è¦æ–¹å¼ã€‚å®ƒæŒ‡ç¤ºæµè§ˆå™¨åœ¨ä½¿ç”¨ç¼“å­˜ä¹‹å‰éœ€è¦å‘é€ä¸€ä¸ªéªŒè¯è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œä»¥ç¡®å®šç¼“å­˜çš„å‰¯æœ¬æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚å¦‚æœæœåŠ¡å™¨è¿”å›äº†çŠ¶æ€ç 304ï¼ˆNot Modifiedï¼‰ï¼Œåˆ™è¡¨ç¤ºç¼“å­˜çš„å‰¯æœ¬ä»ç„¶æœ‰æ•ˆï¼Œæµè§ˆå™¨å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚å¦‚æœæœåŠ¡å™¨è¿”å›äº†æ–°çš„å†…å®¹ï¼Œæµè§ˆå™¨å°†ä½¿ç”¨æ–°çš„å†…å®¹å¹¶æ›´æ–°ç¼“å­˜ã€‚
>
> å»ºè®®åœ¨ç°ä»£çš„Webåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ `Cache-Control: no-cache` æ¥æ§åˆ¶ç¼“å­˜è¡Œä¸ºï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `Pragma: no-cache`ã€‚





### **åœ¨ html é¡µé¢åŠ  `meta` æ ‡ç­¾**

```html
<meta http-equiv="pragram" content="no-cache">
<meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="expires" content="0">
```



### **è¾“å‡ºæ–‡ä»¶æ·»åŠ ç‰ˆæœ¬å·**

#### **ä½¿ç”¨ `Vue` è„šæ‰‹æ¶çš„æƒ…å†µä¸‹ï¼š`vue.config.js`**

```js
// åŠ¨æ€ç‰ˆæœ¬å·
const version = new Date().getTime()
// é…ç½®
module.exports = {
  devServer: {},
  filenameHashing: false, // æ‰“åŒ…çš„æ—¶å€™ä¸ä½¿ç”¨ hash å€¼ï¼Œå› ä¸ºåé¢è‡ªè¡Œæ·»åŠ æ—¶é—´æˆ³æˆ–è€…ç‰ˆæœ¬å·äº†
  css: {
    // æ˜¯å¦ä½¿ç”¨ css åˆ†ç¦»æ’ä»¶ ExtractTextPlugin
    extract: {
      // è¾“å‡ºç¼–è¯‘åçš„æ–‡ä»¶åç§°ï¼šã€æ–‡ä»¶åç§°.æ—¶é—´æˆ³ã€‘ã€ã€æ–‡ä»¶åç§°.ç‰ˆæœ¬å·.æ—¶é—´æˆ³ã€‘...
      filename: `css/[name].${version}.css`,   
      chunkFilename: `css/[name].${version}.css`
       // æˆ–ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼Œé€šè¿‡å›ºå®šç‰ˆæœ¬å·+åŠ¨æ€ç‰ˆæœ¬å·
      // filename: `css/[name].${process.env.VUE_APP_VERSION}.${version}.css`,   
     // chunkFilename: `css/[name].${process.env.VUE_APP_VERSION}.${version}.css`
    }
  },
  configureWebpack: {
    output: { // è¾“å‡ºç¼–è¯‘åçš„æ–‡ä»¶åç§°ï¼šã€æ–‡ä»¶åç§°.æ—¶é—´æˆ³ã€‘ã€ã€æ–‡ä»¶åç§°.ç‰ˆæœ¬å·.æ—¶é—´æˆ³ã€‘...
      filename: `js/[name].${version}.js`,
      chunkFilename: `js/[name].${version}.js`
        // æˆ–ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼Œé€šè¿‡å›ºå®šç‰ˆæœ¬å·+åŠ¨æ€ç‰ˆæœ¬å·
       // filename: `js/[name].${process.env.VUE_APP_VERSION}.${version}.js`,
      // chunkFilename: `js/[name].${process.env.VUE_APP_VERSION}.${version}.js`
    }
  }
}

```



#### **ä½¿ç”¨ `Vue` è„šæ‰‹æ¶çš„æƒ…å†µä¸‹ï¼š`vue.config.js`**

```js
// åŠ¨æ€ç‰ˆæœ¬å·
const version = new Date().getTime()
// é…ç½®
module.exports = {
  devServer: {},
  filenameHashing: false, // æ‰“åŒ…çš„æ—¶å€™ä¸ä½¿ç”¨ hash å€¼ï¼Œå› ä¸ºåé¢è‡ªè¡Œæ·»åŠ æ—¶é—´æˆ³æˆ–è€…ç‰ˆæœ¬å·äº†
  css: {
    // æ˜¯å¦ä½¿ç”¨ css åˆ†ç¦»æ’ä»¶ ExtractTextPlugin
    extract: {
      // è¾“å‡ºç¼–è¯‘åçš„æ–‡ä»¶åç§°ï¼šã€æ–‡ä»¶åç§°.æ—¶é—´æˆ³ã€‘ã€ã€æ–‡ä»¶åç§°.ç‰ˆæœ¬å·.æ—¶é—´æˆ³ã€‘...
      filename: `css/[name].${version}.css`,   
      chunkFilename: `css/[name].${version}.css`
      // æˆ–ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼Œé€šè¿‡å›ºå®šç‰ˆæœ¬å·+åŠ¨æ€ç‰ˆæœ¬å·
     // filename: `css/[name].${process.env.VUE_APP_VERSION}.${version}.css`,   
    // chunkFilename: `css/[name].${process.env.VUE_APP_VERSION}.${version}.css`
    }
  },
  configureWebpack: {
    output: { // è¾“å‡ºç¼–è¯‘åçš„æ–‡ä»¶åç§°ï¼šã€æ–‡ä»¶åç§°.æ—¶é—´æˆ³ã€‘ã€ã€æ–‡ä»¶åç§°.ç‰ˆæœ¬å·.æ—¶é—´æˆ³ã€‘...
      filename: `js/[name].${version}.js`,
      chunkFilename: `js/[name].${version}.js`
       // æˆ–ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼Œé€šè¿‡å›ºå®šç‰ˆæœ¬å·+åŠ¨æ€ç‰ˆæœ¬å·
      // filename: `js/[name].${process.env.VUE_APP_VERSION}.${version}.js`,
     // chunkFilename: `js/[name].${process.env.VUE_APP_VERSION}.${version}.js`
    }
  }
}

```







### **ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥æ’ä»¶**

**æ€è·¯ï¼š**

1. å°†åœ¨åˆ›å»ºé¡¹ç›®æ—¶å€™ï¼Œè‡ªåŠ¨åœ¨æœ¬åœ°ä½¿ç”¨éšæœºæ•°ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬å·ï¼›
2. åœ¨é¡¹ç›®è·¯ç”±ä¸­ï¼Œåˆ‡æ¢é¡µé¢æˆ–æ˜¾ç¤ºé¡µé¢æ—¶ï¼Œæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ï¼š
   * æœ‰æ–°ç‰ˆæœ¬åˆ™ç›´æ¥å¼ºåˆ¶åˆ·æ–°æˆ–æç¤ºç”¨æˆ·åˆ·æ–°ï¼Œæ‹‰å–æœ€æ–°ç‰ˆæœ¬ä»£ç 



**å®ç°ï¼š**

```js
// ä½¿ç”¨ç»†èŠ‚ï¼š
// 1ã€å¯¼å…¥æ–¹å¼ï¼šåœ¨ src æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨å¯ä»¥ const version = require('@/utils/version') è¿™æ ·å¼•å…¥ä½¿ç”¨ï¼Œåœ¨æ ¹ç›®å½•ä¹Ÿå°±æ˜¯ src ä¹‹å¤–çš„æ–‡ä»¶å¤¹åˆ™åªèƒ½ const version = require('./src/utils/version') è¿™æ ·å¼•å…¥ä½¿ç”¨

/** 
  * å¼•å…¥è¯·æ±‚åº“ï¼ˆå¦‚æœæƒ³ä½¿ç”¨ axios è¯·æ±‚ï¼Œæ‰“å¼€æ³¨é‡Šå³å¯ï¼Œä¸‹é¢ get æ–¹æ³•ä¸­ä¹Ÿéœ€è¦æ‰“å¼€æ³¨é‡Šï¼Œé»˜è®¤ä½¿ç”¨JSåŸç”Ÿè¯·æ±‚ï¼‰
  * const axios = require('axios')
  * å¼•å…¥æ–‡ä»¶ç®¡ç†æ¨¡å—ï¼ˆåŸºäº node ç¯å¢ƒï¼Œå¦‚æœä¸ºåŸç”Ÿå‰ç«¯å¼€å‘ï¼Œåˆ™æ³¨é‡Šæ‰ fs ç›¸å…³çš„ä»£ç å³å¯ï¼Œç›´æ¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨ get æ–¹æ³•è·   
  * å–å³å¯ï¼Œæ³¨æ„ç»Ÿä¸€å­˜å‚¨å†…å®¹æ ¼å¼çœ‹ create æ–¹æ³•æ³¨é‡Šï¼‰
 **/
const fs = require('fs')

// æœ¬åœ°ç‰ˆæœ¬å·ç¼“å­˜ key
const storageKey = 'currentVersion'

/**
* åˆ›å»ºç‰ˆæœ¬æ–‡ä»¶ï¼ˆç”±äº fs åŸºäº nodeï¼Œä¸”åªéœ€è¦æ¯æ¬¡ç¼–è¯‘æ—¶åˆ›å»ºæ›´æ–°ä¸€éï¼Œæ‰€ä»¥æ¨èæ”¾ç½®äº vue.config.js æ–‡ä»¶é¡¶éƒ¨ä½¿ç”¨ï¼Œç„¶åä½¿ç”¨ * build å‘½ä»¤æ—¶ä¼šè¢«æˆåŠŸæ‰§è¡Œåˆ›å»ºå¥½æ–‡ä»¶ï¼‰
* path: æ–‡ä»¶è·¯å¾„ä»¥åŠæ–‡ä»¶åç§°ï¼ˆä¾‹å¦‚ï¼šverify.text, public/verify.json éƒ½æ˜¯å­˜åœ¨ public æ–‡ä»¶å¤¹ä¸­ï¼‰
* version: ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ï¼šç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ ...ï¼Œç»Ÿä¸€å­˜å‚¨å†…å®¹ä¸ºï¼š{ version: xxx }ï¼‰
* result: å›è°ƒåˆ›å»ºäºå†™å…¥ç»“æœ
**/ 
function create (path = 'public/verify.json', version = (new Date().getTime()), result) {
  // åœ¨æŒ‡å®šç›®å½•ä¸­æ·»åŠ æ ¡éªŒæ–‡ä»¶
  fs.writeFile(path, JSON.stringify({ version }), (err) => {
    const isOK = !!err
    if (result) { result({ isOK }) }
  })
}

/**
 * è·å–ç‰ˆæœ¬å·ï¼ˆä¸‹é¢ get æ–¹æ³•ï¼‰å‡çº§ç‰ˆï¼ˆè¿”å›ï¼šå½“å‰ç‰ˆæœ¬å·ã€æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ã€‚æ ·ä¾‹ï¼š{ version: xxxï¼Œnew: true }ï¼Œå¹¶ç¼“å­˜å¥½æ–°çš„ç‰ˆæœ¬å·ï¼Œå¯é€‰æ‹©ç›´æ¥åˆ·æ–°é¡µé¢ã€‚
vue æ¨èæ”¾åˆ°è·¯ç”±å®ˆå« router.afterEach(è·¯ç”±è·³è½¬å) å›è°ƒä¸­ï¼Œåˆ‡æ¢é¡µé¢æ—¶éšæ—¶æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦æ›´æ–°ï¼Œè¿™ä¸ªè¯·æ±‚å¾ˆå¿«çš„ï¼Œå ç”¨çš„æ—¶é—´å‡ ä¹å¯ä»¥å¿½ç•¥ï¼Œè€Œä¸”å°±æ˜¯åˆ‡æ¢é¡µé¢å®Œæˆä¹‹åï¼Œå°±ç®—å¤±è´¥æˆ–è€…ç½‘ä¸å¥½ä¹Ÿä¸å½±å“æ­£å¸¸æ“ä½œï¼‰
 *  path: çœ‹ä¸‹é¢ get æ–¹æ³•ä¸­çš„æ³¨é‡Š
 *  isReload: å¦‚æœæœ‰æ–°ç‰ˆæœ¬ä½¿ç”¨ï¼Œæ˜¯å¦é‡æ–°åŠ è½½å½“å‰é¡µé¢ï¼Œå¼ºåˆ¶æµè§ˆå™¨é‡æœåŠ¡å™¨è·å–å½“å‰é¡µé¢èµ„æºï¼Œfalse ä¸ºåç»­è‡ªè¡Œæ‰‹åŠ¨åˆ·æ–°
 **/
function getVersion (path = 'verify.json', isReload = true) {
  return new Promise((resolve, reject) => {
    // è·å–ç‰ˆæœ¬å·
    get(path).then(res => {
      // æœåŠ¡å™¨ç‰ˆæœ¬å·
      const version = res.version
      // æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
      const isNew = isNewAvailable(version)
      // ç¼“å­˜ç‰ˆæœ¬å·
      save(version)
      // æœ‰æ–°ç‰ˆæœ¬çš„è¯æ˜¯å¦é‡æ–°ä»æœåŠ¡å™¨åŠ è½½é¡µé¢æ•°æ®
      if (isNew && isReload) { reload() }
      // è¿”å›
      resolve({ version: version, new: isNew })
    }).catch(err => {
      // è¿”å›
      reject(err)
    })
  })
}

/**
 * è·å–ç‰ˆæœ¬å·ï¼ˆè¿”å›ï¼šå½“å‰ç‰ˆæœ¬å·ã€‚æ ·ä¾‹ï¼š{ version: xxx }ï¼Œvue æ¨èæ”¾åˆ°è·¯ç”±å®ˆå« router.afterEach(è·¯ç”±è·³è½¬å) å›è°ƒä¸­ï¼Œåˆ‡æ¢é¡µé¢æ—¶éšæ—¶æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦æ›´æ–°ï¼Œè¿™ä¸ªè¯·æ±‚å¾ˆå¿«çš„ï¼Œå ç”¨çš„æ—¶é—´å‡ ä¹å¯ä»¥å¿½ç•¥ï¼Œè€Œä¸”å°±æ˜¯åˆ‡æ¢é¡µé¢å®Œæˆä¹‹åï¼Œå°±ç®—å¤±è´¥æˆ–è€…ç½‘ä¸å¥½ä¹Ÿä¸å½±å“æ­£å¸¸æ“ä½œï¼‰
 * path: æœåŠ¡å™¨æ–‡ä»¶è·¯å¾„ï¼ˆä¾‹å¦‚ä¸Š create() ä¸­çš„è·¯å¾„ï¼Œæ–‡ä»¶å­˜ build åå­˜æ”¾åœ¨ public æ–‡ä»¶å¤¹ä¸­ï¼ŒæœåŠ¡å™¨è·¯å¾„åˆ™ç›´æ¥åŸŸ + æ–‡ä»¶åæ—¢å¯ï¼Œå¦‚æœä¸ºåŸç”Ÿå‰ç«¯å¼€å‘ä¹Ÿæ˜¯ä¸€æ ·ï¼‰
 **/
function get (path = 'verify.json') {
  // æœåŠ¡å™¨æ–‡ä»¶è·¯å¾„
  const url = `${ window.location.origin }/${ path }?timestamp=${ new Date().getTime() }`
  
  // axios è¯·æ±‚
  // return new Promise((resolve, reject) => {
  //   // è·å–å†…å®¹
  //   axios.get(url).then(res => {
  //     resolve(res)
  //   }).catch(err => {
  //     reject(err)
  //   })
  // })

  // JSåŸç”Ÿè¯·æ±‚
  return new Promise((resolve, reject) => {
    // åˆ›å»º XMLHttpRequest å¯¹è±¡
    var xhr = null
    if (window.XMLHttpRequest) {
      // ç°ä»£ä¸»æµæµè§ˆå™¨çš„å†™æ³•
      xhr = new XMLHttpRequest()
    } else {
      // IEæµè§ˆå™¨çš„å†™æ³•
      xhr = new ActiveXObject('Microsoft.XMLHTTP')
    }
    // åˆ›å»ºç½‘ç»œè¯·æ±‚å¯¹è±¡
    xhr.open('get', url, true)
    // å‘é€è¯·æ±‚
    xhr.send()
    // è¯·æ±‚å›è°ƒ
    xhr.onreadystatechange = () => {
      // è¿æ¥æˆåŠŸ
      if (xhr.status === 200) {
        // è¯·æ±‚æˆåŠŸ
        if (xhr.readyState === 4) {
          // è¿”å›
          resolve(JSON.parse(xhr.responseText))
        }
      } else {
        // è¿æ¥å¤±è´¥
        reject(new Error('è·å–å¤±è´¥'))
      }
    }
  })
}

/**
 * ç¼“å­˜ç‰ˆæœ¬å·
 * version: ç‰ˆæœ¬å·ï¼ˆæœåŠ¡å™¨è·å–åˆ°çš„ç‰ˆæœ¬å·ï¼‰
 **/
function save (version) {
  localStorage.setItem(storageKey, version)
}

/**
 * æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ï¼ˆtrueï¼šæœ‰æ–°ç‰ˆæœ¬ falseï¼šæ²¡æœ‰æ–°ç‰ˆæœ¬ï¼‰
 * version: ç‰ˆæœ¬å·ï¼ˆæœåŠ¡å™¨è·å–åˆ°çš„ç‰ˆæœ¬å·ï¼‰
 **/
function isNewAvailable (version) {
  // æ²¡å€¼ï¼ˆä¸æ¸…æ¥šæ˜¯å¦ä¸ºæ–°ç‰ˆæœ¬ï¼Œé»˜è®¤è¿”å› false, å¦‚æœè¿™ç§æƒ…å†µä¸‹éœ€è¦åˆ·æ–°ï¼Œå¯ä¿®æ”¹è¿”å› trueï¼‰
  if (!version) { return false }
  // è·å–æœ¬åœ°ç¼“å­˜çš„ç‰ˆæœ¬å·
  const storageVersion = localStorage.getItem(storageKey)
  // æœ¬åœ°æ²¡æœ‰ç‰ˆæœ¬å·ï¼Œè¯´æ˜æœ¬æœºç¬¬ä¸€æ¬¡åŠ è½½ï¼Œä¸ç®—æ–°ç‰ˆæœ¬
  if (!storageVersion || storageVersion === 'undefined') { return false }
  // æœ¬åœ°æœ‰ç‰ˆæœ¬å·ï¼Œè¿›è¡Œå¯¹æ¯”
  return `${version}` !== `${storageVersion}`
}

// åˆ·æ–°å½“å‰ç½‘é¡µ
function reload () {
  // é‡æ–°åŠ è½½å½“å‰é¡µé¢ï¼Œå¼ºåˆ¶æµè§ˆå™¨é‡æœåŠ¡å™¨è·å–å½“å‰é¡µé¢èµ„æº
  window.location.reload(true)
}

// å¯¼å‡º
module.exports = {
  // åˆ›å»ºç‰ˆæœ¬æ–‡ä»¶
  create,
  // è·å–ç‰ˆæœ¬å·
  get,
  // è·å–ç‰ˆæœ¬å·å‡çº§ç‰ˆ
  getVersion,
  // ç¼“å­˜ç‰ˆæœ¬å·
  save,
  // æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
  isNewAvailable,
  // åˆ·æ–°å½“å‰é¡µé¢ï¼Œå¼ºåˆ¶æµè§ˆå™¨é‡æœåŠ¡å™¨è·å–å½“å‰é¡µé¢èµ„æº
  reload
}

```



**ä½¿ç”¨:**

1. åœ¨æ„å»ºæ–‡ä»¶ä¸­å¼•å…¥è„šæœ¬ï¼Œåœ¨é¡¹ç›®æ„å»ºæ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°ç‰ˆæœ¬ï¼š

   ```js
   // åœ¨ build æ—¶ï¼Œæ¯æ¬¡åˆ›å»º/æ›´æ–°ç‰ˆæœ¬æ–‡ä»¶
   const version = require('./src/utils/version')
   version.create()
   ```

2. æ–¹å¼ä¸€ï¼šåœ¨è·¯ç”±å®ˆå«ä¸­æ·»åŠ ç‰ˆæœ¬æ£€æŸ¥ï¼Œå½“è·¯ç”±å‘ç”Ÿå˜åŒ–æ—¶å€™ï¼Œè·å–é¡¹ç›®ç‰ˆæœ¬å·

   ```js
   import router from '@/router'
   const version = require('@/utils/version')
   // è·¯ç”±è·³è½¬åæ‰§è¡Œ
   router.afterEach((to, from) => {
     // å¦‚æœä¸æƒ³æ¯ä¸ªè·¯ç”±éƒ½æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ï¼Œåªéœ€è¦åœ¨ç‰¹å®šçš„é¡µé¢æ‰éœ€è¦æ£€æŸ¥ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨è¿™é‡Œåšç™½åå•åˆ¤æ–­
     // å…¼å®¹ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯æ–°ç‰ˆæœ¬åˆ™è¿›è¡Œåˆ·æ–°å¹¶ç¼“å­˜
     version.getVersion()
   })
   // è·¯ç”±è·³è½¬å‰æ‰§è¡Œ
   router.beforeEach((to, from, next) => {
     next()
   })
   
   ```

3. æ–¹å¼äºŒï¼šå½“æµè§ˆå™¨ é¡µé¢æ˜¾ç¤ºæ—¶å€™ï¼Œè·å–é¡¹ç›®ç‰ˆæœ¬å·

   1. åˆ›å»ºé¡µé¢æ˜¾ç¤ºæ£€æµ‹æ’ä»¶ï¼š

      ```js
      (function() {
        var hidden = "hidden";
      
        // æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒPage Visibility API
        if (hidden in document) {
          document.addEventListener("visibilitychange", handleVisibilityChange);
        } else if ((hidden = "mozHidden") in document) {
          document.addEventListener("mozvisibilitychange", handleVisibilityChange);
        } else if ((hidden = "webkitHidden") in document) {
          document.addEventListener("webkitvisibilitychange", handleVisibilityChange);
        } else if ((hidden = "msHidden") in document) {
          document.addEventListener("msvisibilitychange", handleVisibilityChange);
        } else if ("onfocusin" in document) {
          // å…¼å®¹æ—§ç‰ˆIE
          document.onfocusin = document.onfocusout = handleVisibilityChange;
        } else {
          // å…¼å®¹å…¶ä»–æµè§ˆå™¨
          window.onpageshow = window.onpagehide = window.onfocus = window.onblur = handleVisibilityChange;
        }
      
        function handleVisibilityChange(event) {
          var visible = true;
      
          if (hidden in document) {
            visible = !document[hidden];
          } else if ("mozHidden" in document) {
            visible = !document.mozHidden;
          } else if ("webkitHidden" in document) {
            visible = !document.webkitHidden;
          } else if ("msHidden" in document) {
            visible = !document.msHidden;
          }
      
          if (visible) {
            // ç”¨æˆ·åˆ‡æ¢åˆ°å½“å‰é¡¹ç›®çš„æµè§ˆå™¨é€‰é¡¹å¡ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°
            if (typeof pluginCallback === "function") {
              pluginCallback();
            }
          }
        }
      
        // åœ¨æ’ä»¶ä¸­å®šä¹‰çš„å›è°ƒå‡½æ•°
        var pluginCallback = function() {
          // åœ¨è¿™é‡Œæ‰§è¡Œä½ çš„é€»è¾‘
          console.log("ç”¨æˆ·åˆ‡æ¢åˆ°å½“å‰é¡¹ç›®çš„æµè§ˆå™¨é€‰é¡¹å¡");
        };
      
        // æš´éœ²æ’ä»¶çš„å›è°ƒå‡½æ•°ï¼Œå…è®¸å¤–éƒ¨è®¾ç½®
        window.setPluginCallback = function(callback) {
          if (typeof callback === "function") {
            pluginCallback = callback;
          }
        };
      })();
      ```

      > 1. å°†ä»¥ä¸Šä»£ç ä¿å­˜ä¸ºä¸€ä¸ª JavaScript æ–‡ä»¶ï¼Œä¾‹å¦‚ `tabVisibilityPlugin.js`ã€‚
      >
      > 2. åœ¨ä½ çš„ HTML æ–‡ä»¶ä¸­å¼•å…¥è¯¥æ’ä»¶ï¼š`<script src="tabVisibilityPlugin.js"></script>`ï¼Œæˆ–è€…åœ¨ main.js æ–‡ä»¶ä¸­å¼•å…¥ã€‚
      >
      > 3. åœ¨éœ€è¦æ‰§è¡Œå›è°ƒå‡½æ•°çš„åœ°æ–¹ï¼Œä½¿ç”¨ `setPluginCallback` å‡½æ•°æ¥è®¾ç½®å›è°ƒå‡½æ•°ï¼Œä¾‹å¦‚ï¼š
      >
      >    ```js
      >    setPluginCallback(function() {
      >      // å½“ç”¨æˆ·åˆ‡æ¢åˆ°å½“å‰é¡¹ç›®çš„æµè§ˆå™¨é€‰é¡¹å¡æ—¶ï¼Œæ‰§è¡Œçš„é€»è¾‘
      >      console.log("ç”¨æˆ·åˆ‡æ¢åˆ°å½“å‰é¡¹ç›®çš„æµè§ˆå™¨é€‰é¡¹å¡");
      >    });
      >    ```
      >
      > 4. å½“ç”¨æˆ·åˆ‡æ¢åˆ°ä½ çš„é¡¹ç›®æ‰€åœ¨çš„æµè§ˆå™¨é€‰é¡¹å¡æ—¶ï¼Œä¼šæ‰§è¡Œè®¾ç½®çš„å›è°ƒå‡½æ•°ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦åœ¨å›è°ƒå‡½æ•°ä¸­ç¼–å†™è‡ªå·±çš„é€»è¾‘ã€‚

   2. åœ¨ä½¿ç”¨çš„æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç‰ˆæœ¬æ£€æŸ¥æ’ä»¶å’Œæ˜¾ç¤ºé¡µé¢æ£€æŸ¥æ’ä»¶ï¼š

      ```js
      import router from '@/router'
      const version = require('@/utils/version')
      setPluginCallback(function() {
        // å½“ç”¨æˆ·åˆ‡æ¢åˆ°å½“å‰é¡¹ç›®çš„æµè§ˆå™¨é€‰é¡¹å¡æ—¶ï¼Œæ‰§è¡Œçš„é€»è¾‘
        // å…¼å®¹ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯æ–°ç‰ˆæœ¬åˆ™è¿›è¡Œåˆ·æ–°å¹¶ç¼“å­˜
        version.getVersion()
        console.log("ç”¨æˆ·åˆ‡æ¢åˆ°å½“å‰é¡¹ç›®çš„æµè§ˆå™¨é€‰é¡¹å¡");
      });
      ```

      

#### **å¼€æºç‰ˆæœ¬æ›´æ–°æ’ä»¶**

 [FEMessage/update-popup: ğŸ’¬Display an update message at right bottom (github.com)](https://github.com/FEMessage/update-popup) 



## å‚è€ƒèµ„æ–™

[æµè§ˆå™¨ç¼“å­˜å¸¦æ¥çš„å‰ç«¯é¡¹ç›®æ›´æ–°é—®é¢˜åŠè§£å†³æ–¹æ³• - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7050363329142849543)
